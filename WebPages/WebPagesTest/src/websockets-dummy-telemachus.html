<!DOCTYPE html>
<meta charset="utf-8" />
<html>
<head>
<title>WebSocket Test</title>

<script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
<script type="text/javascript">
    var wsUri = "ws://localhost:8085/server";

    var output;

    function init()
    {
        output = document.getElementById("output"); testWebSocket();
    }

    function testWebSocket()
    {
        websocket = new WebSocket(wsUri); websocket.onopen = function (evt) { onOpen(evt) };
        websocket.onclose = function (evt) { onClose(evt) }; websocket.onmessage = function (evt) { onMessage(evt) }; websocket.onerror = function (evt) { onError(evt) };
    }

    function onOpen(evt)
    {
        writeToScreen("CONNECTED", "#status"); doTest();
    }

    function onClose(evt)
    {
        writeToScreen("DISCONNECTED", "#status");
    }
    function onMessage(evt)
    {
        writeToScreen(evt.data, "#receive");
    }

    function onError(evt)
    {
        writeToScreen(evt.data, "#status");
    }

    function doTest()
    {
        doSend("{\"+\":[\"d.unitless\",\"d.string\"], \"rate\":300, \"run\":[\"d.run[0.5]\"]}");
        //setTimeout(function () { doSend("{\"run\":[\"d.run[0.5]\"]}") }, 5000);
        //setTimeout(function () { doSend("{\"-\":[\"d.unitless\"]}") }, 5000);

        //setTimeout(function () { doSend("{\"run\":[\"d.rrun\"]}") }, 10000);

        //setTimeout(function () { doSend("{\"rate\":1000}") }, 15000);

        //doSend("{}");

        //doSend("{\"+\":[\"d.unitless\",\"d.string\"], \"rate\":300, \"run\":[\"d.run\"]}");
    }

    function doSend(message)
    {
        writeToScreen("SENT: " + message, "#send");
        websocket.send(message);
    }

    function writeToScreen(message, theDiv)
    {
        $(theDiv).text(message);
    }

    window.addEventListener("load", init, false);

</script>
</head>
<body>
<h2>WebSocket Test</h2>
<div id="send">
</div>
<div id="receive">
</div>
<div id="status">
</div>
</body>
</html>
